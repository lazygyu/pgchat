<!DOCTYPE html>
<html>
	<head>
		<title><%= title %></title>
		<link rel='stylesheet' href='/stylesheets/style.css' />
		<script type="text/javascript">

			var members = [];

			function makeEl(tag, opt, cont){
	          var tmp = document.createElement(tag);
	          if( opt ){
	            for(var i in opt){
	              if( opt.hasOwnProperty(i) )
	                if( i == "class" || i == "className" )
	                  tmp.className = opt[i];
	                else
	                  tmp.setAttribute(i, opt[i]);
	            }
	          }

	          if( cont ){
	            tmp.innerHTML = cont;
	          }

	          return tmp;
	        }

	        function $(oid){
	          return document.getElementById(oid);
	        }

			window.fbAsyncInit = function() {
	          FB.init({
	            appId      : '330600707030353', // App ID
	            channelUrl : '/fbchat.lazygyu.net/html/channel.html', // Channel File
	            status     : true, // check login status
	            cookie     : true, // enable cookies to allow the server to access the session
	            xfbml      : true  // parse XFBML
	          });

	          FB.getLoginStatus(function(res){
	          	if( res.status === 'connected'){
	          		document.getElementById('afterLogin').style.display = 'block';
	          		FB.api('/me', function(user) {
			            if (user) {
			              var image = document.getElementById('userIcon');
			              image.src = 'https://graph.facebook.com/' + user.id + '/picture';
			              var name = document.getElementById('username');
			              name.innerHTML = user.name
	                  console.dir(user);
			            }
			          });
	              FB.api( 
	                {
	                  method: 'fql.query', 
	                  query: 'SELECT gid, uid FROM group_member WHERE gid = <%= gid %>' 
	                }, 
	                function(response) { 
	                  for(var i=0,l=response.length;i<l;i++){
	                  	members.push(response[i]);
	                  	makeEl
	                  }
	                });
	          	}else if(res.status === 'not_authorized'){
	          		document.getElementById('beforeLogin').style.display = 'block';
	          	}else{
	          		document.getElementById('beforeLogin').style.display = 'block';
	          	}
	          });
	        };

			// Load the SDK Asynchronously
	        (function(d){
	           var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
	           if (d.getElementById(id)) {return;}
	           js = d.createElement('script'); js.id = id; js.async = true;
	           js.src = "//connect.facebook.net/en_US/all.js";
	           ref.parentNode.insertBefore(js, ref);
	         }(document));
		</script>
		<script type="text/javascript" src="/now.js"></script>
	</head>
	<body>
		<h1 id="groupTitle">Group</h1>
		<div id="groupInfo">
			<p id="groupDescription"></p>
			회원 수 : <span id="groupMemberCount">0</span><br />
		</div>
		<ul id="memberList">
		</ul>
		<div id="chatContainer"></div>
		<div id="inputContainer">
			<img id="userIcon" />
			<textarea id="userInput"></textarea>
		</div>
	</body>
</html>